/*! qrious v4.0.2 | (c) 2018 Alasdair Mercer | https://github.com/neocotic/qrious */
!function(t){function e(t){return null!=t}function n(t,e){return e.forEach(function(e){t[e]=function(){var n=this._options;return arguments.length?void(n[e]=arguments[0]):n[e]}}),t}function r(t){var e,n,r=t.length,i=[],o=[],a=0;for(e=0;r>e;e++)for(n=e+1;r>n;n++)i[a]=t[e],o[a]=t[n],a++;return 0===a?[t]:[i].concat(r>1?[[t[0]]].concat(r>2?[[t[1]]]:[]):[],[o],r>2?[[t[r-2]].concat(r>3?[[t[r-1]]]:[])]:[])}function i(t){return Array.prototype.slice.call(arguments,1).forEach(function(e){e&&Object.keys(e).forEach(function(n){t[n]=e[n]})}),t}function o(){this._options=i({},o.DEFAULTS),this._canvas=t.document.createElement("canvas"),this._context=this._canvas.getContext("2d"),this._image=t.document.createElement("img"),this._image.addEventListener("load",this._onImageLoad.bind(this)),this._image.addEventListener("error",this._onImageError.bind(this)),this._elments={},this._update()}var a="qr:value";o.prototype.configure=function(){return this._update()._render()._elments},o.prototype.get=function(){return this._value},o.prototype.set=function(t){return this._value=t||"",this._update()._render()._elments},o.prototype._draw=function(){if(this._options.backgroundAlpha<1){var t=this._context.globalAlpha;this._context.globalAlpha=this._options.backgroundAlpha,this._context.fillStyle=this._options.background,this._context.fillRect(0,0,this._elementSize,this._elementSize),this._context.globalAlpha=t}else this._context.fillStyle=this._options.background,this._context.fillRect(0,0,this._elementSize,this._elementSize);if(this._options.foregroundAlpha<1){var e=this._context.globalAlpha;this._context.globalAlpha=this._options.foregroundAlpha,this._context.fillStyle=this._options.foreground;for(var n=0;n<this._moduleCount;n++)for(var r=0;r<this._moduleCount;r++)this._modules[n][r]&&this._context.fillRect(r*this._tileSize,n*this._tileSize,this._tileSize,this._tileSize);this._context.globalAlpha=e}else{this._context.fillStyle=this._options.foreground;for(var i=0;i<this._moduleCount;i++)for(var o=0;o<this._moduleCount;o++)this._modules[i][o]&&this._context.fillRect(o*this._tileSize,i*this._tileSize,this._tileSize,this._tileSize)}},o.prototype._getElement=function(t){return this._elments[t]},o.prototype._getService=function(){return this._service||(this._service=new s),this._service},o.prototype._onImageError=function(){this._image.src=""},o.prototype._onImageLoad=function(){this._setImage(this._image)},o.prototype._render=function(){var t=this._getService();if(this._options.value&&"number"==typeof this._options.value.length){var e=t.decode(this._options.value,this._options.level);this._moduleCount=e.length,this._modules=e,this._tileSize=Math.floor(this._options.size/this._moduleCount),this._elementSize=this._tileSize*this._moduleCount,this._options.padding&&(this._elementSize+=2*this._options.padding),this._canvas.width=this._elementSize,this._canvas.height=this._elementSize,this._options.padding?this._context.translate(this._options.padding,this._options.padding):this._context.setTransform(1,0,0,1,0,0),this._draw();var n=this._canvas.toDataURL();return this._options.element?this._setElement(this._options.element):void 0,this._setImage(n)}return this._setImage(""),this},o.prototype._setElement=function(t){if(t){var n=this._canvas.toDataURL();if("CANVAS"===t.nodeName)for(var r in this._canvas)this._canvas.hasOwnProperty(r)&&(t[r]=this._canvas[r]);else"IMG"===t.nodeName&&(t.src=n);this._elments.element=t}},o.prototype._setImage=function(t){this._image.src=t,this._elments.image=this._image,this._elments.canvas=this._canvas},o.prototype._update=function(){var t=this._getService(),i=this._options.level,o=this._options.value?this._options.value.length:0;return i=t.interpret(i,o),this._options.level=i,this._options.padding=Math.max(0,Number(this._options.padding)||o?this._options.padding:0),this._options.size=Math.max(1,Number(this._options.size)||0),this._options.foregroundAlpha=Math.min(1,Math.max(0,Number(this._options.foregroundAlpha)||1)),this._options.backgroundAlpha=Math.min(1,Math.max(0,Number(this._options.backgroundAlpha)||1)),this},o.DEFAULTS={background:"white",backgroundAlpha:1,element:null,foreground:"black",foregroundAlpha:1,level:"L",padding:null,size:100,value:""},n(o.prototype,["background","backgroundAlpha","foreground","foregroundAlpha","level","padding","size","value"]);var s=function(){this._maxVersion=40,this._levels={L:{polynomial:1<<8,capacity:[41,77,127,187,255,322,370,461,552,652,772,883,1022,1101,1250,1408,1548,1725,1903,2061,2232,2409,2620,2812,3057,3283,3517,3669,3909,4158,4417,4686,4965,5253,5529,5836,6153,6479,6743,7089]},M:{polynomial:1<<10,capacity:[34,63,101,149,202,255,293,365,432,513,604,691,796,871,991,1082,1212,1346,1500,1600,1708,1872,2059,2188,2395,2544,2701,2857,3035,3289,3486,3693,3909,4134,4343,4588,4775,5039,5313]},Q:{polynomial:1<<13,capacity:[27,50,76,111,144,178,207,259,312,364,427,489,580,621,703,775,876,948,1063,1159,1224,1358,1468,1588,1718,1804,1933,2085,2181,2358,2473,2670,2805,2949,3081,3244,3417,3599,3791]},H:{polynomial:1<<17,capacity:[17,34,57,82,106,139,154,202,235,288,331,374,427,468,530,602,674,746,813,919,969,1056,1108,1228,1286,1394,1431,1530,1630,1732,1835,1957,2071,2191,2306,2434,2566,2702,2812]}},this._generatorPolynomials=[],this._errorCorrectionPolynomials=[]};s.prototype.decode=function(t,e){var n=this._calcBestVersion(t,e),i=new u(n,e),o=i.createData(t);return i.createModules(o)},s.prototype.interpret=function(t,e){if("string"!=typeof t)throw new TypeError("Invalid error correction level: "+t);var n=this._levels[t.toUpperCase()];if(!n)throw new RangeError("Invalid error correction level: "+t);if(!e)return t;for(var r=this._maxVersion;r>0;r--)if(e<=n.capacity[r-1])return t;throw new RangeError("Too much data")};var l=function(t){this._polynomial=t,this._size=t.length,this._generator=1};l.prototype.get=function(t){return this._polynomial[t]},l.prototype.getLength=function(){return this._polynomial.length},l.prototype.multiply=function(t){for(var e=this._generator,n=this.getLength(),r=new Array(n+t.getLength()-1),i=0;i<r.length;i++)r[i]=0;for(var o=0;o<n;o++)for(var a=0;a<t.getLength();a++)r[o+a]^=e.toAlpha(e.toNumber(this._polynomial[o])+e.toNumber(t.get(a)));return new l(r)},l.prototype.mod=function(t){var e=this._generator,n=this.getLength(),r=t.getLength();if(n<r)return this;var i=new Array(n);i.forEach=function(t,e){i[e]=t},this._polynomial.forEach(function(t,n){i[n]=t});for(var o=0;n-r>=0;)if(i[o]){for(var a=0;r>a;a++)i[o+a]^=e.toAlpha(e.toNumber(t.get(a))+e.toNumber(i[o+a]))}else o++;return new l(i.slice(i.length-r+1,i.length))};var u=function(t,e){this._version=t,this._level=e,this._size=4*t+17,this._calculate();var n=this._positionings={};n.horizontal=[(0===t?0:t-1)*70+44,this._size-7],n.vertical=[(0===t?0:t-1)*70+44,this._size-7],this._positioningCenters=r(this._calcPositioningCenters()),this._alignmentPatternLocations=r(this._calcAlignmentPatternLocations())};u.prototype.createData=function(t){var n=this._calcDataBits(t),r=this._calcRequiredBits(n),i=this._createDataBits(n,r),o=this._interleaveBlocks(i);return this._padData(o,r)},u.prototype.createModules=function(t){var e=new Array(this._size);for(var n=0;n<this._size;n++)e[n]=new Array(this._size);return this._placePositioningPatterns(e),this._placeAlignmentPatterns(e),this._placeTimingPatterns(e),this._reserveFormatInformation(e),this._placeData(e,t),this._placeFormatInformation(e),this._modules=e,e};var f=Object.freeze({});t.QRious=o,"undefined"!=typeof module&&module.exports?module.exports=o:"undefined"!=typeof define&&define.amd?define(function(){return o}):t.QRious=o}("undefined"!=typeof window?window:this);
